"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
/* tslint:disable:completed-docs no-empty no-invalid-this member-access */
const ava_1 = require("ava");
const denali_1 = require("denali");
function buildAndSave(adapter, type, data) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        let record = adapter.buildRecord(type, data);
        let model = {
            type,
            record,
            get id() {
                return this.record.id;
            }
        };
        yield adapter.saveRecord(model);
        return model;
    });
}
ava_1.default.beforeEach((t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    t.context.container = new denali_1.Container(__dirname);
    t.context.adapter = new denali_1.MemoryAdapter();
}));
ava_1.default('find returns record with given id', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let model = yield buildAndSave(adapter, 'foo', { bar: true });
    let result = yield adapter.find('foo', model.record.id);
    t.deepEqual(result, model.record);
}));
ava_1.default('find returns null for non-existent id', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    t.is(yield adapter.find('whatever', 0), null);
}));
ava_1.default('queryOne returns the first record that matches the given query', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let type = 'foo';
    let matching = yield buildAndSave(adapter, type, { number: 'one', bar: true });
    yield buildAndSave(adapter, type, { number: 'two', bar: true });
    yield buildAndSave(adapter, type, { number: 'three', bar: false });
    let result = yield adapter.queryOne(type, { bar: true });
    t.deepEqual(result, matching.record);
}));
ava_1.default('queryOne returns null if query does not match anything', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    t.is(yield adapter.queryOne('whatever', { whatever: true }), null);
}));
ava_1.default('all returns all records', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let type = 'foo';
    let modelOne = yield buildAndSave(adapter, type, { number: 'one' });
    let modelTwo = yield buildAndSave(adapter, type, { number: 'two' });
    let result = yield adapter.all(type);
    t.deepEqual(result, [modelOne.record, modelTwo.record]);
}));
ava_1.default('query returns all records that match a given query', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let type = 'foo';
    let matchingOne = yield buildAndSave(adapter, type, { number: 'one', bar: true });
    let matchingTwo = yield buildAndSave(adapter, type, { number: 'two', bar: true });
    yield buildAndSave(adapter, type, { number: 'three', bar: false });
    let result = yield adapter.query(type, { bar: true });
    t.deepEqual(result, [matchingOne.record, matchingTwo.record]);
}));
ava_1.default('get and set attributes', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let record = adapter.buildRecord('foo', { bar: true });
    let model = { record };
    adapter.setAttribute(model, 'bar', false);
    adapter.setAttribute(model, 'fizz', 'buzz');
    t.is(adapter.getAttribute(model, 'bar'), false);
    t.is(adapter.getAttribute(model, 'fizz'), 'buzz');
}));
ava_1.default('getRelated returns related records', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let post = yield buildAndSave(adapter, 'post', {});
    let comment = yield buildAndSave(adapter, 'comment', { text: 'great post!' });
    let descriptor = denali_1.hasMany('comment');
    adapter.setRelated(post, 'comments', descriptor, [comment]);
    let result = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(result, [comment.record]);
}));
ava_1.default('setRelated replaces related records', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let post = yield buildAndSave(adapter, 'post', {});
    let comment = yield buildAndSave(adapter, 'comment', { text: 'great post!' });
    let descriptor = denali_1.hasMany('comment');
    adapter.setRelated(post, 'comments', descriptor, [comment]);
    let sanityCheck = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(sanityCheck, [comment.record]);
    let newComment = yield buildAndSave(adapter, 'comment', { text: 'even greater post!' });
    adapter.setRelated(post, 'comments', descriptor, [newComment]);
    let result = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(result, [newComment.record]);
}));
ava_1.default('addRelated adds a related record to a has many relationship', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let post = yield buildAndSave(adapter, 'post', {});
    let comment = yield buildAndSave(adapter, 'comment', { text: 'great post!' });
    let descriptor = denali_1.hasMany('comment');
    adapter.setRelated(post, 'comments', descriptor, [comment]);
    let sanityCheck = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(sanityCheck, [comment.record]);
    let newComment = yield buildAndSave(adapter, 'comment', { text: 'even greater post!' });
    adapter.addRelated(post, 'comments', descriptor, newComment);
    let result = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(result, [comment.record, newComment.record]);
}));
ava_1.default('removeRelated destroys a relationship between related records', (t) => tslib_1.__awaiter(this, void 0, void 0, function* () {
    let adapter = t.context.adapter;
    let post = yield buildAndSave(adapter, 'post', {});
    let comment = yield buildAndSave(adapter, 'comment', { text: 'great post!' });
    let descriptor = denali_1.hasMany('comment');
    adapter.setRelated(post, 'comments', descriptor, [comment]);
    let sanityCheck = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(sanityCheck, [comment.record]);
    adapter.removeRelated(post, 'comments', descriptor, comment);
    let result = yield adapter.getRelated(post, 'comments', descriptor, null);
    t.deepEqual(result, []);
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVtb3J5LXRlc3QuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3NlYXdhdHRzL3NyYy9naXRodWIuY29tL3NlYXdhdHRzL2RlbmFsaS8iLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9kYXRhL21lbW9yeS10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBFQUEwRTtBQUMxRSw2QkFBdUI7QUFDdkIsbUNBQTJEO0FBRTNELHNCQUE0QixPQUFzQixFQUFFLElBQVksRUFBRSxJQUFTOztRQUN6RSxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM3QyxJQUFJLEtBQUssR0FBUTtZQUNmLElBQUk7WUFDSixNQUFNO1lBQ04sSUFBSSxFQUFFO2dCQUNKLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUN4QixDQUFDO1NBQ0YsQ0FBQztRQUNGLE1BQU0sT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUFBO0FBRUQsYUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFPLENBQUM7SUFDdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxrQkFBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksc0JBQWEsRUFBRSxDQUFDO0FBQzFDLENBQUMsQ0FBQSxDQUFDLENBQUM7QUFFSCxhQUFJLENBQUMsbUNBQW1DLEVBQUUsQ0FBTyxDQUFDO0lBQ2hELElBQUksT0FBTyxHQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztJQUMvQyxJQUFJLEtBQUssR0FBRyxNQUFNLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFFOUQsSUFBSSxN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QUFDO0lBQ25ELElBQUksT0FBTyxHQUFHLE1BQU0sWUFBWSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUM5RSxJQUFJLFVBQVUsR0FBRyxnQkFBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3BDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsQ0FBRSxPQUFPLENBQUUsQ0FBQyxDQUFDO0lBQzlELElBQUksV0FBVyxHQUFHLE1BQU0sT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMvRSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUUsQ0FBQyxDQUFDO0lBRTdDLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFN0QsSUFBSSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFFLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQzFCLENBQUMsQ0FBQSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpjb21wbGV0ZWQtZG9jcyBuby1lbXB0eSBuby1pbnZhbGlkLXRoaXMgbWVtYmVyLWFjY2VzcyAqL1xuaW1wb3J0IHRlc3QgZnJvbSAnYXZhJztcbmltcG9ydCB7IENvbnRhaW5lciwgTWVtb3J5QWRhcHRlciwgaGFzTWFueSB9IGZyb20gJ2RlbmFsaSc7XG5cbmFzeW5jIGZ1bmN0aW9uIGJ1aWxkQW5kU2F2ZShhZGFwdGVyOiBNZW1vcnlBZGFwdGVyLCB0eXBlOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICBsZXQgcmVjb3JkID0gYWRhcHRlci5idWlsZFJlY29yZCh0eXBlLCBkYXRhKTtcbiAgbGV0IG1vZGVsID0gPGFueT57XG4gICAgdHlwZSxcbiAgICByZWNvcmQsXG4gICAgZ2V0IGlkKCkge1xuICAgICAgcmV0dXJuIHRoaXMucmVjb3JkLmlkO1xuICAgIH1cbiAgfTtcbiAgYXdhaXQgYWRhcHRlci5zYXZlUmVjb3JkKG1vZGVsKTtcbiAgcmV0dXJuIG1vZGVsO1xufVxuXG50ZXN0LmJlZm9yZUVhY2goYXN5bmMgKHQpID0+IHtcbiAgdC5jb250ZXh0LmNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoX19kaXJuYW1lKTtcbiAgdC5jb250ZXh0LmFkYXB0ZXIgPSBuZXcgTWVtb3J5QWRhcHRlcigpO1xufSk7XG5cbnRlc3QoJ2ZpbmQgcmV0dXJucyByZWNvcmQgd2l0aCBnaXZlbiBpZCcsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBhZGFwdGVyOiBNZW1vcnlBZGFwdGVyID0gdC5jb250ZXh0LmFkYXB0ZXI7XG4gIGxldCBtb2RlbCA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCAnZm9vJywgeyBiYXI6IHRydWUgfSk7XG5cbiAgbGV0IHJlc3VsdCA9IGF3YWl0IGFkYXB0ZXIuZmluZCgnZm9vJywgbW9kZWwucmVjb3JkLmlkKTtcbiAgdC5kZWVwRXF1YWwocmVzdWx0LCBtb2RlbC5yZWNvcmQpO1xufSk7XG5cbnRlc3QoJ2ZpbmQgcmV0dXJucyBudWxsIGZvciBub24tZXhpc3RlbnQgaWQnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgYWRhcHRlcjogTWVtb3J5QWRhcHRlciA9IHQuY29udGV4dC5hZGFwdGVyO1xuXG4gIHQuaXMoYXdhaXQgYWRhcHRlci5maW5kKCd3aGF0ZXZlcicsIDApLCBudWxsKTtcbn0pO1xuXG50ZXN0KCdxdWVyeU9uZSByZXR1cm5zIHRoZSBmaXJzdCByZWNvcmQgdGhhdCBtYXRjaGVzIHRoZSBnaXZlbiBxdWVyeScsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBhZGFwdGVyOiBNZW1vcnlBZGFwdGVyID0gdC5jb250ZXh0LmFkYXB0ZXI7XG4gIGxldCB0eXBlID0gJ2Zvbyc7XG4gIGxldCBtYXRjaGluZyA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCB0eXBlLCB7IG51bWJlcjogJ29uZScsIGJhcjogdHJ1ZSB9KTtcbiAgYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsIHR5cGUsIHsgbnVtYmVyOiAndHdvJywgYmFyOiB0cnVlIH0pO1xuICBhd2FpdCBidWlsZEFuZFNhdmUoYWRhcHRlciwgdHlwZSwgeyBudW1iZXI6ICd0aHJlZScsIGJhcjogZmFsc2UgfSk7XG5cbiAgbGV0IHJlc3VsdCA9IGF3YWl0IGFkYXB0ZXIucXVlcnlPbmUodHlwZSwgeyBiYXI6IHRydWUgfSk7XG4gIHQuZGVlcEVxdWFsKHJlc3VsdCwgbWF0Y2hpbmcucmVjb3JkKTtcbn0pO1xuXG50ZXN0KCdxdWVyeU9uZSByZXR1cm5zIG51bGwgaWYgcXVlcnkgZG9lcyBub3QgbWF0Y2ggYW55dGhpbmcnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgYWRhcHRlcjogTWVtb3J5QWRhcHRlciA9IHQuY29udGV4dC5hZGFwdGVyO1xuXG4gIHQuaXMoYXdhaXQgYWRhcHRlci5xdWVyeU9uZSgnd2hhdGV2ZXInLCB7IHdoYXRldmVyOiB0cnVlIH0pLCBudWxsKTtcbn0pO1xuXG50ZXN0KCdhbGwgcmV0dXJucyBhbGwgcmVjb3JkcycsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBhZGFwdGVyOiBNZW1vcnlBZGFwdGVyID0gdC5jb250ZXh0LmFkYXB0ZXI7XG4gIGxldCB0eXBlID0gJ2Zvbyc7XG4gIGxldCBtb2RlbE9uZSA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCB0eXBlLCB7IG51bWJlcjogJ29uZScgfSk7XG4gIGxldCBtb2RlbFR3byA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCB0eXBlLCB7IG51bWJlcjogJ3R3bycgfSk7XG5cbiAgbGV0IHJlc3VsdCA9IGF3YWl0IGFkYXB0ZXIuYWxsKHR5cGUpO1xuICB0LmRlZXBFcXVhbChyZXN1bHQsIFsgbW9kZWxPbmUucmVjb3JkLCBtb2RlbFR3by5yZWNvcmQgXSk7XG59KTtcblxudGVzdCgncXVlcnkgcmV0dXJucyBhbGwgcmVjb3JkcyB0aGF0IG1hdGNoIGEgZ2l2ZW4gcXVlcnknLCBhc3luYyAodCkgPT4ge1xuICBsZXQgYWRhcHRlcjogTWVtb3J5QWRhcHRlciA9IHQuY29udGV4dC5hZGFwdGVyO1xuICBsZXQgdHlwZSA9ICdmb28nO1xuICBsZXQgbWF0Y2hpbmdPbmUgPSBhd2FpdCBidWlsZEFuZFNhdmUoYWRhcHRlciwgdHlwZSwgeyBudW1iZXI6ICdvbmUnLCBiYXI6IHRydWUgfSk7XG4gIGxldCBtYXRjaGluZ1R3byA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCB0eXBlLCB7IG51bWJlcjogJ3R3bycsIGJhcjogdHJ1ZSB9KTtcbiAgYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsIHR5cGUsIHsgbnVtYmVyOiAndGhyZWUnLCBiYXI6IGZhbHNlIH0pO1xuXG4gIGxldCByZXN1bHQgPSBhd2FpdCBhZGFwdGVyLnF1ZXJ5KHR5cGUsIHsgYmFyOiB0cnVlIH0pO1xuICB0LmRlZXBFcXVhbChyZXN1bHQsIFsgbWF0Y2hpbmdPbmUucmVjb3JkLCBtYXRjaGluZ1R3by5yZWNvcmQgXSk7XG59KTtcblxudGVzdCgnZ2V0IGFuZCBzZXQgYXR0cmlidXRlcycsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBhZGFwdGVyOiBNZW1vcnlBZGFwdGVyID0gdC5jb250ZXh0LmFkYXB0ZXI7XG4gIGxldCByZWNvcmQgPSBhZGFwdGVyLmJ1aWxkUmVjb3JkKCdmb28nLCB7IGJhcjogdHJ1ZSB9KTtcbiAgbGV0IG1vZGVsID0gPGFueT57IHJlY29yZCB9O1xuICBhZGFwdGVyLnNldEF0dHJpYnV0ZShtb2RlbCwgJ2JhcicsIGZhbHNlKTtcbiAgYWRhcHRlci5zZXRBdHRyaWJ1dGUobW9kZWwsICdmaXp6JywgJ2J1enonKTtcblxuICB0LmlzKGFkYXB0ZXIuZ2V0QXR0cmlidXRlKG1vZGVsLCAnYmFyJyksIGZhbHNlKTtcbiAgdC5pcyhhZGFwdGVyLmdldEF0dHJpYnV0ZShtb2RlbCwgJ2ZpenonKSwgJ2J1enonKTtcbn0pO1xuXG50ZXN0KCdnZXRSZWxhdGVkIHJldHVybnMgcmVsYXRlZCByZWNvcmRzJywgYXN5bmMgKHQpID0+IHtcbiAgbGV0IGFkYXB0ZXI6IE1lbW9yeUFkYXB0ZXIgPSB0LmNvbnRleHQuYWRhcHRlcjtcbiAgbGV0IHBvc3QgPSBhd2FpdCBidWlsZEFuZFNhdmUoYWRhcHRlciwgJ3Bvc3QnLCB7fSk7XG4gIGxldCBjb21tZW50ID0gYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsICdjb21tZW50JywgeyB0ZXh0OiAnZ3JlYXQgcG9zdCEnIH0pO1xuICBsZXQgZGVzY3JpcHRvciA9IGhhc01hbnkoJ2NvbW1lbnQnKTtcbiAgYWRhcHRlci5zZXRSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIFsgY29tbWVudCBdKTtcblxuICBsZXQgcmVzdWx0ID0gYXdhaXQgYWRhcHRlci5nZXRSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIG51bGwpO1xuICB0LmRlZXBFcXVhbChyZXN1bHQsIFsgY29tbWVudC5yZWNvcmQgXSk7XG59KTtcblxudGVzdCgnc2V0UmVsYXRlZCByZXBsYWNlcyByZWxhdGVkIHJlY29yZHMnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgYWRhcHRlcjogTWVtb3J5QWRhcHRlciA9IHQuY29udGV4dC5hZGFwdGVyO1xuICBsZXQgcG9zdCA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCAncG9zdCcsIHt9KTtcbiAgbGV0IGNvbW1lbnQgPSBhd2FpdCBidWlsZEFuZFNhdmUoYWRhcHRlciwgJ2NvbW1lbnQnLCB7IHRleHQ6ICdncmVhdCBwb3N0IScgfSk7XG4gIGxldCBkZXNjcmlwdG9yID0gaGFzTWFueSgnY29tbWVudCcpO1xuICBhZGFwdGVyLnNldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgWyBjb21tZW50IF0pO1xuICBsZXQgc2FuaXR5Q2hlY2sgPSBhd2FpdCBhZGFwdGVyLmdldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgbnVsbCk7XG4gIHQuZGVlcEVxdWFsKHNhbml0eUNoZWNrLCBbIGNvbW1lbnQucmVjb3JkIF0pO1xuXG4gIGxldCBuZXdDb21tZW50ID0gYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsICdjb21tZW50JywgeyB0ZXh0OiAnZXZlbiBncmVhdGVyIHBvc3QhJyB9KTtcbiAgYWRhcHRlci5zZXRSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIFsgbmV3Q29tbWVudCBdKTtcblxuICBsZXQgcmVzdWx0ID0gYXdhaXQgYWRhcHRlci5nZXRSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIG51bGwpO1xuICB0LmRlZXBFcXVhbChyZXN1bHQsIFsgbmV3Q29tbWVudC5yZWNvcmQgXSk7XG59KTtcblxudGVzdCgnYWRkUmVsYXRlZCBhZGRzIGEgcmVsYXRlZCByZWNvcmQgdG8gYSBoYXMgbWFueSByZWxhdGlvbnNoaXAnLCBhc3luYyAodCkgPT4ge1xuICBsZXQgYWRhcHRlcjogTWVtb3J5QWRhcHRlciA9IHQuY29udGV4dC5hZGFwdGVyO1xuICBsZXQgcG9zdCA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCAncG9zdCcsIHt9KTtcbiAgbGV0IGNvbW1lbnQgPSBhd2FpdCBidWlsZEFuZFNhdmUoYWRhcHRlciwgJ2NvbW1lbnQnLCB7IHRleHQ6ICdncmVhdCBwb3N0IScgfSk7XG4gIGxldCBkZXNjcmlwdG9yID0gaGFzTWFueSgnY29tbWVudCcpO1xuICBhZGFwdGVyLnNldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgWyBjb21tZW50IF0pO1xuICBsZXQgc2FuaXR5Q2hlY2sgPSBhd2FpdCBhZGFwdGVyLmdldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgbnVsbCk7XG4gIHQuZGVlcEVxdWFsKHNhbml0eUNoZWNrLCBbIGNvbW1lbnQucmVjb3JkIF0pO1xuXG4gIGxldCBuZXdDb21tZW50ID0gYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsICdjb21tZW50JywgeyB0ZXh0OiAnZXZlbiBncmVhdGVyIHBvc3QhJyB9KTtcbiAgYWRhcHRlci5hZGRSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIG5ld0NvbW1lbnQpO1xuXG4gIGxldCByZXN1bHQgPSBhd2FpdCBhZGFwdGVyLmdldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgbnVsbCk7XG4gIHQuZGVlcEVxdWFsKHJlc3VsdCwgWyBjb21tZW50LnJlY29yZCwgbmV3Q29tbWVudC5yZWNvcmQgXSk7XG59KTtcblxudGVzdCgncmVtb3ZlUmVsYXRlZCBkZXN0cm95cyBhIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHJlbGF0ZWQgcmVjb3JkcycsIGFzeW5jICh0KSA9PiB7XG4gIGxldCBhZGFwdGVyOiBNZW1vcnlBZGFwdGVyID0gdC5jb250ZXh0LmFkYXB0ZXI7XG4gIGxldCBwb3N0ID0gYXdhaXQgYnVpbGRBbmRTYXZlKGFkYXB0ZXIsICdwb3N0Jywge30pO1xuICBsZXQgY29tbWVudCA9IGF3YWl0IGJ1aWxkQW5kU2F2ZShhZGFwdGVyLCAnY29tbWVudCcsIHsgdGV4dDogJ2dyZWF0IHBvc3QhJyB9KTtcbiAgbGV0IGRlc2NyaXB0b3IgPSBoYXNNYW55KCdjb21tZW50Jyk7XG4gIGFkYXB0ZXIuc2V0UmVsYXRlZChwb3N0LCAnY29tbWVudHMnLCBkZXNjcmlwdG9yLCBbIGNvbW1lbnQgXSk7XG4gIGxldCBzYW5pdHlDaGVjayA9IGF3YWl0IGFkYXB0ZXIuZ2V0UmVsYXRlZChwb3N0LCAnY29tbWVudHMnLCBkZXNjcmlwdG9yLCBudWxsKTtcbiAgdC5kZWVwRXF1YWwoc2FuaXR5Q2hlY2ssIFsgY29tbWVudC5yZWNvcmQgXSk7XG5cbiAgYWRhcHRlci5yZW1vdmVSZWxhdGVkKHBvc3QsICdjb21tZW50cycsIGRlc2NyaXB0b3IsIGNvbW1lbnQpO1xuXG4gIGxldCByZXN1bHQgPSBhd2FpdCBhZGFwdGVyLmdldFJlbGF0ZWQocG9zdCwgJ2NvbW1lbnRzJywgZGVzY3JpcHRvciwgbnVsbCk7XG4gIHQuZGVlcEVxdWFsKHJlc3VsdCwgW10pO1xufSk7XG4iXX0=