"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* tslint:disable:completed-docs no-empty no-invalid-this member-access */
const ava_1 = require("ava");
const denali_1 = require("denali");
const lodash_1 = require("lodash");
function mockRequest(options) {
    return new denali_1.Request(new denali_1.MockRequest(options));
}
function mockBasic(mockMessage) {
    // Create a stub url so that the Request instantiation won't fail
    mockMessage.url = 'example.com';
    // Cast object to an IncomingMessage to satisfy tsc
    return new denali_1.Request(mockMessage);
}
ava_1.default('method returns correct method', (t) => {
    let request = mockRequest({
        method: 'put'
    });
    t.is(request.method, 'put');
});
ava_1.default('hostname returns Host header without port number', (t) => {
    let request = mockRequest({
        headers: {
            host: 'example.com:1234'
        }
    });
    t.is(request.hostname, 'example.com');
});
ava_1.default('hostname doesn\'t fail when host header is not defined', (t) => {
    let request = mockRequest();
    t.is(request.hostname, '');
});
ava_1.default('ip returns remote address of socket', (t) => {
    let request = mockRequest();
    t.is(request.ip, '123.45.67.89');
});
ava_1.default('originalUrl returns the pathname of the url', (t) => {
    let request = mockRequest({
        url: 'https://example.com/a/b/c/d/'
    });
    t.is(request.originalUrl, '/a/b/c/d/');
});
ava_1.default('protocol', (t) => {
    let request = mockRequest({
        url: 'https://example.com/'
    });
    let request2 = mockRequest({
        url: 'http://example.com/'
    });
    t.is(request.protocol, 'https:');
    t.is(request2.protocol, 'http:');
});
ava_1.default('secure returns true for https', (t) => {
    let request = mockRequest({
        url: 'https://example.com/'
    });
    t.is(request.secure, true);
});
ava_1.default('xhr returns true for ajax requests', (t) => {
    let request = mockRequest({
        headers: {
            'x-requested-with': 'XMLHttpRequest'
        }
    });
    t.is(request.xhr, true);
});
ava_1.default('subdomains return an array of subdomains from request url', (t) => {
    let request = mockRequest({
        headers: {
            host: 'a.example.com'
        }
    });
    let request2 = mockRequest({
        headers: {
            host: 'a.b.c.example.com'
        }
    });
    t.deepEqual(request.subdomains, ['a']);
    t.deepEqual(request2.subdomains, ['a', 'b', 'c']);
});
ava_1.default('get returns header value', (t) => {
    let request = mockRequest({
        headers: {
            foo: 'bar',
            baz: 'qux'
        }
    });
    t.is(request.get('foo'), 'bar');
    t.is(request.get('baz'), 'qux');
});
ava_1.default('headers returns all request headers', (t) => {
    let request = mockRequest({
        headers: {
            foo: 'bar',
            baz: 'qux'
        }
    });
    t.deepEqual(request.headers, {
        foo: 'bar',
        baz: 'qux'
    });
});
ava_1.default('accepts returns correct type', (t) => {
    let request = mockRequest({
        headers: {
            accept: 'text/html'
        }
    });
    let request2 = mockRequest({
        headers: {
            accept: 'application/json'
        }
    });
    t.is(request.accepts(['json', 'html']), 'html');
    t.is(request2.accepts(['json', 'html']), 'json');
});
ava_1.default('is returns correct values', (t) => {
    let request = mockRequest({
        method: 'post',
        headers: {
            'content-type': 'application/json',
            'content-length': 2
        }
    });
    let request2 = mockRequest({
        method: 'post',
        headers: {
            'content-type': 'text/html',
            'content-length': 7
        }
    });
    t.is(request.is('html'), false);
    t.is(request.is('json'), 'json');
    t.is(request2.is('json'), false);
});
// The following tests are basic coverage-boosting tests for the Request class
// They only test whether or not the method/property calls are passed through
// to the IncomingMessage object
ava_1.default('incoming message properties are passed through', (t) => {
    t.plan(8);
    let props = {
        httpVersion: 0,
        rawHeaders: 1,
        rawTrailers: 2,
        socket: 3,
        statusCode: 4,
        statusMessage: 5,
        trailers: 6,
        connection: 7
    };
    // Use cloneDeep because props is mutated
    let req = mockBasic(lodash_1.cloneDeep(props));
    Object.keys(props).forEach((prop, i) => {
        t.is(req[prop], i);
    });
});
// self-returning methods
const selfReturningMethods = [
    'addListener',
    'on',
    'once',
    'prependListener',
    'prependOnceListener',
    'removeAllListeners',
    'removeListener',
    'setMaxListeners',
    'pause',
    'resume',
    'setEncoding',
    'setTimeout'
];
// Normal-returning methods
const normalReturningMethods = [
    'emit',
    'eventNames',
    'getMaxListeners',
    'listenerCount',
    'listeners',
    'isPaused',
    'pipe',
    'read',
    'unpipe',
    'unshift',
    'wrap',
    'destroy'
];
selfReturningMethods.forEach((method) => {
    ava_1.default(`self-returning pass through method > ${method}`, (t) => {
        t.plan(2);
        let req = mockBasic({
            [method]() { t.pass(); }
        });
        t.deepEqual(req[method](), req, `${method} returns the Request object`);
    });
});
normalReturningMethods.forEach((method, i) => {
    ava_1.default(`pass through method > ${method}`, (t) => {
        t.plan(2);
        let req = mockBasic({
            [method]() { t.pass(); return i; }
        });
        t.is(req[method](), i, `${method} returns the value from the passed through method`);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVxdWVzdC10ZXN0LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9zZWF3YXR0cy9zcmMvZ2l0aHViLmNvbS9zZWF3YXR0cy9kZW5hbGkvIiwic291cmNlcyI6WyJ0ZXN0L3VuaXQvcnVudGltZS9yZXF1ZXN0LXRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwwRUFBMEU7QUFDMUUsNkJBQXVCO0FBRXZCLG1DQUE4QztBQUM5QyxtQ0FBbUM7QUFFbkMscUJBQXFCLE9BQWE7SUFDaEMsTUFBTSxDQUFDLElBQUksZ0JBQU8sQ0FBTSxJQUFJLG9CQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDO0FBRUQsbUJBQW1CLFdBQWlCO0lBQ2xDLGlFQUFpRTtJQUNqRSxXQUFXLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQztJQUNoQyxtREFBbUQ7SUFDbkQsTUFBTSxDQUFDLElBQUksZ0JBQU8sQ0FBbUIsV0FBWSxDQUFDLENBQUM7QUFDckQsQ0FBQztBQUVELGFBQUksQ0FBQywrQkFBK0IsRUFBRSxDQUFDLENBQUM7SUFDdEMsSUFBSSxPQUFPLEdBQUcsV0FBVyxDQUFDO1FBQ3hCLE1BQU0sRUFBRSxLQUFLO0tBQ2QsQ0FBQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzlCLENBQUMsQ0FBQyxDQUFDO0FBRUgsYUFBSSxDQUFDLGtEQUFrRCxFQUFFLENBQUMsQ0FBQztJQUN6RCxJQUFJLE9BQU8sR0FBRyxXQUFXLENBQUM7UUFDeEIsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLGtCQUFrQjtTQUN6QjtLQUNGLENBQUMsQ0FBQztJQUNILENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUN4QyxDQUFDLENBQUMsQ0FBQztBQUVILGFBQUksQ0FBQyx3REFBd0QsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFB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QUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVWLElBQUksR0FBRyxHQUFTLFNBQVMsQ0FBQztZQUN4QixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ25DLENBQUUsQ0FBQztRQUVKLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUksTUFBTyxtREFBbUQsQ0FBQyxDQUFDO0lBQ3pGLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpjb21wbGV0ZWQtZG9jcyBuby1lbXB0eSBuby1pbnZhbGlkLXRoaXMgbWVtYmVyLWFjY2VzcyAqL1xuaW1wb3J0IHRlc3QgZnJvbSAnYXZhJztcbmltcG9ydCB7IEluY29taW5nTWVzc2FnZSB9IGZyb20gJ2h0dHAnO1xuaW1wb3J0IHsgUmVxdWVzdCwgTW9ja1JlcXVlc3QgfSBmcm9tICdkZW5hbGknO1xuaW1wb3J0IHsgY2xvbmVEZWVwIH0gZnJvbSAnbG9kYXNoJztcblxuZnVuY3Rpb24gbW9ja1JlcXVlc3Qob3B0aW9ucz86IGFueSk6IFJlcXVlc3Qge1xuICByZXR1cm4gbmV3IFJlcXVlc3QoPGFueT5uZXcgTW9ja1JlcXVlc3Qob3B0aW9ucykpO1xufVxuXG5mdW5jdGlvbiBtb2NrQmFzaWMobW9ja01lc3NhZ2U/OiBhbnkpOiBSZXF1ZXN0IHtcbiAgLy8gQ3JlYXRlIGEgc3R1YiB1cmwgc28gdGhhdCB0aGUgUmVxdWVzdCBpbnN0YW50aWF0aW9uIHdvbid0IGZhaWxcbiAgbW9ja01lc3NhZ2UudXJsID0gJ2V4YW1wbGUuY29tJztcbiAgLy8gQ2FzdCBvYmplY3QgdG8gYW4gSW5jb21pbmdNZXNzYWdlIHRvIHNhdGlzZnkgdHNjXG4gIHJldHVybiBuZXcgUmVxdWVzdCgoPEluY29taW5nTWVzc2FnZT5tb2NrTWVzc2FnZSkpO1xufVxuXG50ZXN0KCdtZXRob2QgcmV0dXJucyBjb3JyZWN0IG1ldGhvZCcsICh0KSA9PiB7XG4gIGxldCByZXF1ZXN0ID0gbW9ja1JlcXVlc3Qoe1xuICAgIG1ldGhvZDogJ3B1dCdcbiAgfSk7XG4gIHQuaXMocmVxdWVzdC5tZXRob2QsICdwdXQnKTtcbn0pO1xuXG50ZXN0KCdob3N0bmFtZSByZXR1cm5zIEhvc3QgaGVhZGVyIHdpdGhvdXQgcG9ydCBudW1iZXInLCAodCkgPT4ge1xuICBsZXQgcmVxdWVzdCA9IG1vY2tSZXF1ZXN0KHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICBob3N0OiAnZXhhbXBsZS5jb206MTIzNCdcbiAgICB9XG4gIH0pO1xuICB0LmlzKHJlcXVlc3QuaG9zdG5hbWUsICdleGFtcGxlLmNvbScpO1xufSk7XG5cbnRlc3QoJ2hvc3RuYW1lIGRvZXNuXFwndCBmYWlsIHdoZW4gaG9zdCBoZWFkZXIgaXMgbm90IGRlZmluZWQnLCAodCkgPT4ge1xuICBsZXQgcmVxdWVzdCA9IG1vY2tSZXF1ZXN0KCk7XG4gIHQuaXMocmVxdWVzdC5ob3N0bmFtZSwgJycpO1xufSk7XG5cbnRlc3QoJ2lwIHJldHVybnMgcmVtb3RlIGFkZHJlc3Mgb2Ygc29ja2V0JywgKHQpID0+IHtcbiAgbGV0IHJlcXVlc3QgPSBtb2NrUmVxdWVzdCgpO1xuICB0LmlzKHJlcXVlc3QuaXAsICcxMjMuNDUuNjcuODknKTtcbn0pO1xuXG50ZXN0KCdvcmlnaW5hbFVybCByZXR1cm5zIHRoZSBwYXRobmFtZSBvZiB0aGUgdXJsJywgKHQpID0+IHtcbiAgbGV0IHJlcXVlc3QgPSBtb2NrUmVxdWVzdCh7XG4gICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9hL2IvYy9kLydcbiAgfSk7XG4gIHQuaXMocmVxdWVzdC5vcmlnaW5hbFVybCwgJy9hL2IvYy9kLycpO1xufSk7XG5cbnRlc3QoJ3Byb3RvY29sJywgKHQpID0+IHtcbiAgbGV0IHJlcXVlc3QgPSBtb2NrUmVxdWVzdCh7XG4gICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS8nXG4gIH0pO1xuICBsZXQgcmVxdWVzdDIgPSBtb2NrUmVxdWVzdCh7XG4gICAgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tLydcbiAgfSk7XG5cbiAgdC5pcyhyZXF1ZXN0LnByb3RvY29sLCAnaHR0cHM6Jyk7XG4gIHQuaXMocmVxdWVzdDIucHJvdG9jb2wsICdodHRwOicpO1xufSk7XG5cbnRlc3QoJ3NlY3VyZSByZXR1cm5zIHRydWUgZm9yIGh0dHBzJywgKHQpID0+IHtcbiAgbGV0IHJlcXVlc3QgPSBtb2NrUmVxdWVzdCh7XG4gICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS8nXG4gIH0pO1xuXG4gIHQuaXMocmVxdWVzdC5zZWN1cmUsIHRydWUpO1xufSk7XG5cbnRlc3QoJ3hociByZXR1cm5zIHRydWUgZm9yIGFqYXggcmVxdWVzdHMnLCAodCkgPT4ge1xuICBsZXQgcmVxdWVzdCA9IG1vY2tSZXF1ZXN0KHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICAneC1yZXF1ZXN0ZWQtd2l0aCc6ICdYTUxIdHRwUmVxdWVzdCdcbiAgICB9XG4gIH0pO1xuXG4gIHQuaXMocmVxdWVzdC54aHIsIHRydWUpO1xufSk7XG5cbnRlc3QoJ3N1YmRvbWFpbnMgcmV0dXJuIGFuIGFycmF5IG9mIHN1YmRvbWFpbnMgZnJvbSByZXF1ZXN0IHVybCcsICh0KSA9PiB7XG4gIGxldCByZXF1ZXN0ID0gbW9ja1JlcXVlc3Qoe1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIGhvc3Q6ICdhLmV4YW1wbGUuY29tJ1xuICAgIH1cbiAgfSk7XG4gIGxldCByZXF1ZXN0MiA9IG1vY2tSZXF1ZXN0KHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICBob3N0OiAnYS5iLmMuZXhhbXBsZS5jb20nXG4gICAgfVxuICB9KTtcblxuICB0LmRlZXBFcXVhbChyZXF1ZXN0LnN1YmRvbWFpbnMsIFsnYSddKTtcbiAgdC5kZWVwRXF1YWwocmVxdWVzdDIuc3ViZG9tYWlucywgWydhJywgJ2InLCAnYyddKTtcbn0pO1xuXG50ZXN0KCdnZXQgcmV0dXJucyBoZWFkZXIgdmFsdWUnLCAodCkgPT4ge1xuICBsZXQgcmVxdWVzdCA9IG1vY2tSZXF1ZXN0KHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICBmb286ICdiYXInLFxuICAgICAgYmF6OiAncXV4J1xuICAgIH1cbiAgfSk7XG5cbiAgdC5pcyhyZXF1ZXN0LmdldCgnZm9vJyksICdiYXInKTtcbiAgdC5pcyhyZXF1ZXN0LmdldCgnYmF6JyksICdxdXgnKTtcbn0pO1xuXG50ZXN0KCdoZWFkZXJzIHJldHVybnMgYWxsIHJlcXVlc3QgaGVhZGVycycsICh0KSA9PiB7XG4gIGxldCByZXF1ZXN0ID0gbW9ja1JlcXVlc3Qoe1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIGZvbzogJ2JhcicsXG4gICAgICBiYXo6ICdxdXgnXG4gICAgfVxuICB9KTtcblxuICB0LmRlZXBFcXVhbChyZXF1ZXN0LmhlYWRlcnMsIHtcbiAgICBmb286ICdiYXInLFxuICAgIGJhejogJ3F1eCdcbiAgfSk7XG59KTtcblxudGVzdCgnYWNjZXB0cyByZXR1cm5zIGNvcnJlY3QgdHlwZScsICh0KSA9PiB7XG4gIGxldCByZXF1ZXN0ID0gbW9ja1JlcXVlc3Qoe1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIGFjY2VwdDogJ3RleHQvaHRtbCdcbiAgICB9XG4gIH0pO1xuICBsZXQgcmVxdWVzdDIgPSBtb2NrUmVxdWVzdCh7XG4gICAgaGVhZGVyczoge1xuICAgICAgYWNjZXB0OiAnYXBwbGljYXRpb24vanNvbidcbiAgICB9XG4gIH0pO1xuXG4gIHQuaXMocmVxdWVzdC5hY2NlcHRzKFsnanNvbicsICdodG1sJ10pLCAnaHRtbCcpO1xuICB0LmlzKHJlcXVlc3QyLmFjY2VwdHMoWydqc29uJywgJ2h0bWwnXSksICdqc29uJyk7XG59KTtcblxudGVzdCgnaXMgcmV0dXJucyBjb3JyZWN0IHZhbHVlcycsICh0KSA9PiB7XG4gIGxldCByZXF1ZXN0ID0gbW9ja1JlcXVlc3Qoe1xuICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAnY29udGVudC1sZW5ndGgnOiAyXG4gICAgfVxuICB9KTtcbiAgbGV0IHJlcXVlc3QyID0gbW9ja1JlcXVlc3Qoe1xuICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgICdjb250ZW50LXR5cGUnOiAndGV4dC9odG1sJyxcbiAgICAgICdjb250ZW50LWxlbmd0aCc6IDdcbiAgICB9XG4gIH0pO1xuXG4gIHQuaXMocmVxdWVzdC5pcygnaHRtbCcpLCBmYWxzZSk7XG4gIHQuaXMocmVxdWVzdC5pcygnanNvbicpLCAnanNvbicpO1xuICB0LmlzKHJlcXVlc3QyLmlzKCdqc29uJyksIGZhbHNlKTtcbn0pO1xuXG4vLyBUaGUgZm9sbG93aW5nIHRlc3RzIGFyZSBiYXNpYyBjb3ZlcmFnZS1ib29zdGluZyB0ZXN0cyBmb3IgdGhlIFJlcXVlc3QgY2xhc3Ncbi8vIFRoZXkgb25seSB0ZXN0IHdoZXRoZXIgb3Igbm90IHRoZSBtZXRob2QvcHJvcGVydHkgY2FsbHMgYXJlIHBhc3NlZCB0aHJvdWdoXG4vLyB0byB0aGUgSW5jb21pbmdNZXNzYWdlIG9iamVjdFxuXG50ZXN0KCdpbmNvbWluZyBtZXNzYWdlIHByb3BlcnRpZXMgYXJlIHBhc3NlZCB0aHJvdWdoJywgKHQpID0+IHtcbiAgdC5wbGFuKDgpO1xuXG4gIGxldCBwcm9wcyA9IHtcbiAgICBodHRwVmVyc2lvbjogMCxcbiAgICByYXdIZWFkZXJzOiAxLFxuICAgIHJhd1RyYWlsZXJzOiAyLFxuICAgIHNvY2tldDogMyxcbiAgICBzdGF0dXNDb2RlOiA0LFxuICAgIHN0YXR1c01lc3NhZ2U6IDUsXG4gICAgdHJhaWxlcnM6IDYsXG4gICAgY29ubmVjdGlvbjogN1xuICB9O1xuICAvLyBVc2UgY2xvbmVEZWVwIGJlY2F1c2UgcHJvcHMgaXMgbXV0YXRlZFxuICBsZXQgcmVxID0gKDxhbnk+bW9ja0Jhc2ljKGNsb25lRGVlcChwcm9wcykpKTtcblxuICBPYmplY3Qua2V5cyhwcm9wcykuZm9yRWFjaCgocHJvcCwgaSkgPT4ge1xuICAgIHQuaXMocmVxW3Byb3BdLCBpKTtcbiAgfSk7XG59KTtcblxuLy8gc2VsZi1yZXR1cm5pbmcgbWV0aG9kc1xuY29uc3Qgc2VsZlJldHVybmluZ01ldGhvZHMgPSBbXG4gICdhZGRMaXN0ZW5lcicsXG4gICdvbicsXG4gICdvbmNlJyxcbiAgJ3ByZXBlbmRMaXN0ZW5lcicsXG4gICdwcmVwZW5kT25jZUxpc3RlbmVyJyxcbiAgJ3JlbW92ZUFsbExpc3RlbmVycycsXG4gICdyZW1vdmVMaXN0ZW5lcicsXG4gICdzZXRNYXhMaXN0ZW5lcnMnLFxuICAncGF1c2UnLFxuICAncmVzdW1lJyxcbiAgJ3NldEVuY29kaW5nJyxcbiAgJ3NldFRpbWVvdXQnXG5dO1xuXG4vLyBOb3JtYWwtcmV0dXJuaW5nIG1ldGhvZHNcbmNvbnN0IG5vcm1hbFJldHVybmluZ01ldGhvZHMgPSBbXG4gICdlbWl0JyxcbiAgJ2V2ZW50TmFtZXMnLFxuICAnZ2V0TWF4TGlzdGVuZXJzJyxcbiAgJ2xpc3RlbmVyQ291bnQnLFxuICAnbGlzdGVuZXJzJyxcbiAgJ2lzUGF1c2VkJyxcbiAgJ3BpcGUnLFxuICAncmVhZCcsXG4gICd1bnBpcGUnLFxuICAndW5zaGlmdCcsXG4gICd3cmFwJyxcbiAgJ2Rlc3Ryb3knXG5dO1xuXG5zZWxmUmV0dXJuaW5nTWV0aG9kcy5mb3JFYWNoKChtZXRob2QpID0+IHtcbiAgdGVzdChgc2VsZi1yZXR1cm5pbmcgcGFzcyB0aHJvdWdoIG1ldGhvZCA+ICR7IG1ldGhvZCB9YCwgKHQpID0+IHtcbiAgICB0LnBsYW4oMik7XG5cbiAgICBsZXQgcmVxID0gKDxhbnk+bW9ja0Jhc2ljKHtcbiAgICAgIFttZXRob2RdKCkgeyB0LnBhc3MoKTsgfVxuICAgIH0pKTtcblxuICAgIHQuZGVlcEVxdWFsKHJlcVttZXRob2RdKCksIHJlcSwgYCR7IG1ldGhvZCB9IHJldHVybnMgdGhlIFJlcXVlc3Qgb2JqZWN0YCk7XG4gIH0pO1xufSk7XG5cbm5vcm1hbFJldHVybmluZ01ldGhvZHMuZm9yRWFjaCgobWV0aG9kLCBpKSA9PiB7XG4gIHRlc3QoYHBhc3MgdGhyb3VnaCBtZXRob2QgPiAkeyBtZXRob2QgfWAsICh0KSA9PiB7XG4gICAgdC5wbGFuKDIpO1xuXG4gICAgbGV0IHJlcSA9ICg8YW55Pm1vY2tCYXNpYyh7XG4gICAgICBbbWV0aG9kXSgpIHsgdC5wYXNzKCk7IHJldHVybiBpOyB9XG4gICAgfSkpO1xuXG4gICAgdC5pcyhyZXFbbWV0aG9kXSgpLCBpLCBgJHsgbWV0aG9kIH0gcmV0dXJucyB0aGUgdmFsdWUgZnJvbSB0aGUgcGFzc2VkIHRocm91Z2ggbWV0aG9kYCk7XG4gIH0pO1xufSlcbiJdfQ==